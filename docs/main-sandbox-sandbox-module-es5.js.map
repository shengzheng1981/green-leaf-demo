{"version":3,"sources":["webpack:///src/app/main/sandbox/sandbox.module.ts","webpack:///src/app/main/sandbox/sandbox.component.ts","webpack:///src/app/main/sandbox/sandbox.component.scss","webpack:///src/app/main/sandbox/sandbox.component.html"],"names":["routes","path","component","SandboxModule","imports","forChild","declarations","SandboxComponent","router","configService","http","scripts","editor","CodeMirror","fromTextArea","textarea","nativeElement","lineNumbers","styleActiveLine","mode","get","subscribe","data","source","items","script","setValue","run","getValue","setTimeout","iframe","document","createElement","style","height","width","parent","sandbox","firstChild","removeChild","appendChild","frameDocument","contentDocument","contentWindow","open","write","close","selector","template"],"mappings":"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","file":"main-sandbox-sandbox-module-es5.js","sourcesContent":["import {NgModule} from '@angular/core';\nimport {RouterModule, Routes} from \"@angular/router\";\nimport {CoreModule} from \"../../core/core.module\";\nimport {SharedModule as MainSharedModule} from \"../shared/shared.module\";\nimport {SandboxComponent} from \"./sandbox.component\";\n\nconst routes: Routes = [\n    {\n        path: '',\n        component: SandboxComponent\n    }\n];\n\n@NgModule({\n    imports: [\n        CoreModule.forChild(),\n        MainSharedModule,\n        RouterModule.forChild(routes)\n    ],\n    declarations: [\n        SandboxComponent\n    ]\n})\nexport class SandboxModule {\n}\n","import {Component, ElementRef, OnInit, ViewChild} from '@angular/core';\nimport {ConfigService} from \"../../core/config.service\";\nimport {Router} from \"@angular/router\";\nimport {\n    Feature,\n    FeatureClass,\n    FeatureLayer, Field,\n    GeometryType, Graphic,\n    Label, NullCollision,\n    Point, SimpleMarkerSymbol,\n    SimplePointSymbol,\n    SimpleTextSymbol\n} from \"green-gis\";\nimport {HttpClient} from \"@angular/common/http\";\ndeclare var CodeMirror;\n@Component({\n    selector: 'app-sandbox',\n    templateUrl: './sandbox.component.html',\n    styleUrls: ['./sandbox.component.scss']\n})\nexport class SandboxComponent implements OnInit {\n    @ViewChild('sandbox', {static:true}) sandbox: ElementRef;\n    @ViewChild('textarea', {static:true}) textarea: ElementRef;\n    editor: any;\n    source: string;\n\n    scripts: any = [];\n\n    constructor(private router: Router, public configService: ConfigService, private http: HttpClient) {\n    }\n\n    ngOnInit(): void {\n        this.editor = CodeMirror.fromTextArea(this.textarea.nativeElement, {\n            lineNumbers: true,\n            styleActiveLine: true,\n            mode: \"htmlmixed\"\n        });\n        this.http.get(\"assets/json/scripts.json\").subscribe( data => {\n            this.scripts = data;\n            this.source = this.scripts[0].items[0].script;\n            this.editor.setValue(this.source);\n            this.run();\n        });\n        this.source = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <script type=\"text/javascript\" src=\"https://unpkg.com/green-leaf@0.0.7/green-leaf.js\"></script>\n  <link rel=\"stylesheet\" href=\"https://unpkg.com/green-leaf@0.0.7/leaflet.css\">\n</head>\n<body style=\"margin: 0px; overflow: hidden;\">\n  <div id=\"foo\" style=\"width: 100%; height: 100%; overflow: hidden;\"></div>\n  <script>\n    const map = new Green.Map(\"foo\");\n    //加载OSM切片\n    const tile = new Green.Tile('http://{s}.tile.osm.org/{z}/{x}/{y}.png');\n    tile.addTo(map);\n    \n    map.setView(new Green.LatLng(39.909186, 116.397411), 12);\n    //设置渲染符号\n    const symbol = new Green.SimplePointSymbol();\n    const point = new Green.Point(new Green.LatLng(39.909186, 116.397411));\n    const graphic = new Green.Graphic(point, symbol);\n    //添加单个图形\n    map.addGraphic(graphic);\n  </script>\n</body>\n</html>`;\n    }\n\n    change(script) {\n        this.source = script;\n        this.editor.setValue(this.source);\n        this.run();\n    }\n\n    run() {\n        this.source = this.editor.getValue();\n        setTimeout(() => {\n          const iframe = document.createElement('iframe');\n          iframe.style.height = \"100%\";\n          iframe.style.width = \"100%\";\n          iframe.style[\"border\"] = \"1px solid #ededed\";\n          iframe.style[\"box-shadow\"] = \"3px 3px 8px rgba(0,0,0,0.2)\";\n          const parent = this.sandbox.nativeElement;\n          while (parent.firstChild) {\n            parent.removeChild(parent.firstChild);\n          }\n          parent.appendChild(iframe);\n\n          const frameDocument = iframe.contentDocument || iframe.contentWindow.document;\n          frameDocument.open();\n          frameDocument.write(this.source);\n          frameDocument.close();\n            // this.sandbox.nativeElement.contentWindow.document.body.innerHTML = \"\";\n            // this.sandbox.nativeElement.contentDocument.open();\n            // this.sandbox.nativeElement.contentDocument.write(this.source);\n            // this.sandbox.nativeElement.contentDocument.close();\n        });\n    }\n\n}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzYW5kYm94LmNvbXBvbmVudC5zY3NzIn0= */\";","export default \"<div class=\\\"system-content\\\" style=\\\"grid-template-columns: 1fr\\\">\\n    <div class=\\\"system-body\\\" style=\\\"display: grid; grid-template-columns: 1fr 2fr 3fr;\\\">\\n        <ul nz-menu nzMode=\\\"inline\\\" style=\\\"overflow-y: auto; overflow-x: hidden;\\\">\\n            <li nz-submenu *ngFor=\\\"let group of scripts\\\" [nzTitle]=\\\"group.title\\\" [nzOpen]=\\\"group.open\\\">\\n                <ul>\\n                    <li nz-menu-item *ngFor=\\\"let item of group.items\\\" [nzSelected]=\\\"item.selected\\\" (click)=\\\"change(item.script)\\\">{{item.title}}</li>\\n                </ul>\\n            </li>\\n        </ul>\\n        <div class=\\\"panel panel-grid\\\" style=\\\"height: 100%; width: 100%; padding: 10px;\\\">\\n            <div class=\\\"panel-heading\\\" style=\\\"display: grid; grid-template-columns: 1fr auto\\\">\\n                <div class=\\\"panel-title\\\">源码</div>\\n                <div class=\\\"panel-action\\\">\\n                    <button class=\\\"btn btn-xs btn-primary\\\" (click)=\\\"run()\\\">运行</button>\\n                </div>\\n            </div>\\n            <div class=\\\"panel-body\\\" style=\\\"overflow-y: hidden;\\\">\\n                <textarea #textarea style=\\\"height: 100%; width: 100%;\\\"></textarea>\\n            </div>\\n        </div>\\n        <div #sandbox class=\\\"panel\\\" style=\\\"height: 100%; width: 100%; padding: 10px;\\\">\\n            <!-- <iframe sandbox=\\\"allow-same-origin allow-scripts\\\" style=\\\"height: 100%; width: 100%; border: 1px solid #ededed;\\n            box-shadow: 3px 3px 8px rgba(0,0,0,0.2)\\\"></iframe> -->\\n        </div>\\n    </div>\\n</div>\\n\";"]}